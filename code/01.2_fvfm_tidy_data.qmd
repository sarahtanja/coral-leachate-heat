---
title: "Tidy up the data"
subtitle: "From measurements taken by a Walz Diving PAMII"
author: "Sarah Tanja"
date: "`r format(Sys.time(), '%d %B, %Y')`"  
format:
  html:
    df-print: paged
    toc: true
    toc-location: right
    smooth-scroll: true
    link-external-icon: true
    link-external-newwindow: true
    code-fold: false
    code-tools: true
    code-copy: true
    highlight-style: breeze
    code-overflow: wrap
    theme: minty
editor: 
  markdown: 
    wrap: 72
---

# Overview

Quasi dark-adapted rapid light curve analysis from measurements taken by
a Walz Diving PAMII...

# Install and load packages

```{r}
# Install packages
if ("tidyverse" %in% rownames(installed.packages()) == 'FALSE') install.packages('tidyverse')
if ("dplyr" %in% rownames(installed.packages()) == 'FALSE') install.packages('dplyr')

# Load packages
library(dplyr)
library(tidyverse)
```


# Pull in data

This data is generated by the report tab in the Win-3 Control Software of the Walz Diving PAM II. Metadata (sample_id, temp, leachate, etc.) were manually entered into the EXCEL workbook generated by Win Control 3. 

```{r}
fvfm_0713 <- read_csv("../pam-data/fvfm_07132024.csv")
fvfm_0714 <- read_csv("../pam-data/fvfm_07142024.csv")
fvfm_0715 <- read_csv("../pam-data/fvfm_07152024.csv")
fvfm_0716 <- read_csv("../pam-data/fvfm_07162024.csv")
fvfm_0717 <- read_csv("../pam-data/fvfm_07172024.csv")
```

# Tidy it up

## Day 0 | July 13th 2024

```{r}
print(fvfm_0713)
```


```{r}
fvfm_day0 <- fvfm_0713 %>% 
  filter(!is.na(sample_id)) %>% 
  rename(FvFm = '1:Fv/Fm') %>% 
  rename(Fm = '1:Fm') %>% 
  rename(Fo = '1:Fo') %>% 
  mutate(days_of_exposure = 0) %>% 
  mutate(days_of_exposure = as.factor(days_of_exposure)) %>% 
  mutate(treatment = str_c(temp, leachate, sep = "_")) %>% 
  mutate(treatment = as.factor(treatment))

fvfm_day0
```
```{r}
fvfm_day0 <- fvfm_day0 %>% 
  select(
    #Date, 
    #Time...2,
    Fo, 
    Fm, 
    FvFm, 
    sample_id,
    temp, 
    colony, 
    leachate, 
    species,
    days_of_exposure, 
    treatment
  )
```


## Day 1 | July 14th 2024
```{r}
fvfm_day1 <- fvfm_0714 %>% 
  filter(!is.na(sample_id)) %>% 
  rename(FvFm = '1:Fv/Fm') %>% 
  rename(Fm = '1:Fm') %>% 
  rename(Fo = '1:Fo') %>% 
  mutate(days_of_exposure = 1) %>% 
  mutate(days_of_exposure = as.factor(days_of_exposure)) %>% 
  mutate(treatment = str_c(temp, leachate, sep = "_")) %>% 
  mutate(treatment = as.factor(treatment))

fvfm_day1
```

```{r}
fvfm_day1 <- fvfm_day1 %>% 
  select(
    #Date, 
    #Time,
    Fo, 
    Fm, 
    FvFm, 
    sample_id,
    temp, 
    colony, 
    leachate, 
    species,
    days_of_exposure, 
    treatment
  )
```


## Day 2 | July 15th 2024
```{r}
fvfm_day2 <- fvfm_0715 %>% 
  filter(!is.na(sample_id)) %>% 
  rename(FvFm = '1:Fv/Fm') %>% 
  rename(Fm = '1:Fm') %>% 
  rename(Fo = '1:Fo') %>% 
  mutate(days_of_exposure = 2) %>% 
  mutate(days_of_exposure = as.factor(days_of_exposure)) %>% 
  mutate(treatment = str_c(temp, leachate, sep = "_")) %>% 
  mutate(treatment = as.factor(treatment))

fvfm_day2
```
```{r}
fvfm_day2 <- fvfm_day2 %>% 
  select(
    #Date, 
    #Time,
    Fo, 
    Fm, 
    FvFm, 
    sample_id,
    temp, 
    colony, 
    leachate, 
    species,
    days_of_exposure, 
    treatment
  )
```


## Day 3 | July 16th 2024
```{r}
fvfm_day3 <- fvfm_0716 %>% 
  filter(!is.na(sample_id)) %>% 
  rename(FvFm = '1:Fv/Fm') %>% 
  rename(Fm = '1:Fm') %>% 
  rename(Fo = '1:Fo') %>% 
  mutate(days_of_exposure = 3) %>% 
  mutate(days_of_exposure = as.factor(days_of_exposure)) %>% 
  mutate(treatment = str_c(temp, leachate, sep = "_")) %>% 
  mutate(treatment = as.factor(treatment))

fvfm_day3
```
```{r}
fvfm_day3 <- fvfm_day3 %>% 
  select(
    #Date, 
    #Time,
    Fo, 
    Fm, 
    FvFm, 
    sample_id,
    temp, 
    colony, 
    leachate, 
    species,
    days_of_exposure, 
    treatment
  )
```

## Day 4 | July 17th 2024
```{r}
fvfm_day4 <- fvfm_0717 %>% 
  filter(!is.na(sample_id)) %>% 
  rename(FvFm = '1:Fv/Fm') %>% 
  rename(Fm = '1:Fm') %>% 
  rename(Fo = '1:Fo') %>% 
  mutate(days_of_exposure = 4) %>% 
  mutate(days_of_exposure = as.factor(days_of_exposure)) %>% 
  mutate(treatment = str_c(temp, leachate, sep = "_")) %>% 
  mutate(treatment = as.factor(treatment))

fvfm_day4
```
```{r}
fvfm_day4 <- fvfm_day4 %>% 
  select(
    #Date, 
    #Time,
    Fo, 
    Fm, 
    FvFm, 
    sample_id,
    temp, 
    colony, 
    leachate, 
    species,
    days_of_exposure, 
    treatment
  )
```


# Bind rows with `rbind` so that data is in long format 
See [here](https://courses.washington.edu/psy524a/_book/repeated-measures-anova.html#repeated-measures-with-more-than-two-levels:~:text=This%20data%20is%20stored%20in%20%E2%80%98long%20format%E2%80%99%2C%20where%20each%20row%20in%20the%20table%20corresponds%20to%20a%20different%20observation)
about long format data for lmer

```{r}
fvfm_alldays <- do.call(rbind, list(fvfm_day0, fvfm_day1, fvfm_day2, fvfm_day3, fvfm_day4))
```

# Save Fv/Fm dataframes as .csv

```{r}
write.csv(fvfm_0713, file = "../output/fvfm_day0.csv")
write.csv(fvfm_0714, file = "../output/fvfm_day1.csv" )
write.csv(fvfm_0715, file = "../output/fvfm_day2.csv" )
write.csv(fvfm_0716, file = "../output/fvfm_day3.csv" )
write.csv(fvfm_0717, file = "../output/fvfm_day4.csv" )
write.csv(fvfm_alldays, file = "../output/fvfm_alldays.csv")
```

::: callout-important
Proceed with analysis of calculated RLC regression variables from Jasby
& Platt (1976) (rERTm, Ik, Alpha) and dark adapted quantum yield (Fv/Fm)
by running two-way anovas and doing initial data visualization in
`02_anovas.qmd`
:::
